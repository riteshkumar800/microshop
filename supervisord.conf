[supervisord]
nodaemon=true
logfile=/dev/null
pidfile=/tmp/supervisord.pid

; ---------- FastAPI apps ----------
[program:product]
directory=/app/product-service
command=uvicorn main:app --app-dir src --app-dir . --host 0.0.0.0 --port 8000
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
environment=DATABASE_URL="sqlite+aiosqlite:///data.db"

[program:user]
directory=/app/user-service
command=uvicorn main:app --app-dir src --app-dir . --host 0.0.0.0 --port 8001
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

[program:order]
directory=/app/order-service
command=uvicorn main:app --app-dir src --app-dir . --host 0.0.0.0 --port 8002
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
environment=PRODUCT_SERVICE_URL="http://127.0.0.1:8000"

[program:payment]
directory=/app/payment-service
command=uvicorn main:app --app-dir src --app-dir . --host 0.0.0.0 --port 8003
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

; ---------- Nginx ----------
[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
priority=999
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
